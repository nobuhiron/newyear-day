---
import Image from 'astro/components/Image.astro';
import type { ImageMetadata } from 'astro';

interface Props {
  image:
    | { src: ImageMetadata; alt: string; width?: number; height?: number }
    | { src: string; alt: string; width?: number; height?: number };
  title: string;
  subtitle?: string;
  price: string;
  description: string;
  buttonHref?: string;
}

const { image, title, price, description, buttonHref } = Astro.props;

// 画像オブジェクトか文字列かを判定
const isImageMetadata = (
  img: typeof image
): img is {
  src: ImageMetadata;
  alt: string;
  width?: number;
  height?: number;
} => {
  return typeof img.src === 'object' && img.src !== null && 'src' in img.src;
};
---

<article class='c-special-item'>
  <div class='c-special-item__image-wrapper'>
    {
      isImageMetadata(image) ? (
        <Image
          src={image.src}
          alt={image.alt}
          class='c-special-item__image'
          width={image.width || image.src.width || 400}
          height={image.height || image.src.height || 300}
          loading='lazy'
        />
      ) : (
        <img
          src={image.src}
          alt={image.alt}
          class='c-special-item__image'
          width={image.width || 400}
          height={image.height || 300}
          loading='lazy'
        />
      )
    }
  </div>
  <div class='c-special-item__info'>
    <header class='c-special-item__info-header'>
      <h3 class='c-special-item__title'>{title}</h3>
      <div class='c-special-item__price'>
        <span class='c-special-item__price-yen'>¥</span>
        <span class='c-special-item__price-value'>{price}</span>
        <span class='c-special-item__price-unit'> (税込)</span>
      </div>
    </header>
    <div class='c-special-item__divider'></div>
    <div class='c-special-item__info-body'>
      <p class='c-special-item__description'>{description}</p>
      <a href={buttonHref} class='c-special-item__button'>
        詳しくはこちら
        <svg
          class='c-special-item__button-icon'
          aria-hidden='true'
          width='16'
          height='16'
          viewBox='0 0 16 16'
          fill='none'
          xmlns='http://www.w3.org/2000/svg'
        >
          <path
            d='M6 4L10 8L6 12'
            stroke='currentColor'
            stroke-width='2'
            stroke-linecap='round'
            stroke-linejoin='round'></path>
        </svg>
      </a>
    </div>
  </div>
</article>
