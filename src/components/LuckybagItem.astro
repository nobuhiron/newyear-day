---
import Image from 'astro/components/Image.astro';
import type { ImageMetadata } from 'astro';

interface Props {
  image:
    | { src: ImageMetadata; alt: string; width?: number; height?: number }
    | { src: string; alt: string; width?: number; height?: number };
  title: string;
  price: string;
  contents: Array<{ name: string; quantity: string }>;
  buttonHref: string;
  reverse?: boolean;
}

const {
  image,
  title,
  price,
  contents,
  buttonHref,
  reverse = false,
} = Astro.props;

// 画像オブジェクトか文字列かを判定
const isImageMetadata = (
  img: typeof image
): img is {
  src: ImageMetadata;
  alt: string;
  width?: number;
  height?: number;
} => {
  return typeof img.src === 'object' && img.src !== null && 'src' in img.src;
};

const leftContents = contents.slice(0, Math.ceil(contents.length / 2));
const rightContents = contents.slice(Math.ceil(contents.length / 2));
---

<article class={`c-luckybag-item ${reverse ? 'c-luckybag-item--reverse' : ''}`}>
  <div class='c-luckybag-item__image-wrapper'>
    {
      isImageMetadata(image) ? (
        <Image
          src={image.src}
          alt={image.alt}
          class='c-luckybag-item__image'
          width={image.width || image.src.width || 400}
          height={image.height || image.src.height || 300}
          loading='lazy'
        />
      ) : (
        <img
          src={image.src}
          alt={image.alt}
          class='c-luckybag-item__image'
          width={image.width || 400}
          height={image.height || 300}
          loading='lazy'
        />
      )
    }
  </div>
  <div class='c-luckybag-item__info'>
    <div class='c-luckybag-item__price'>{price}</div>
    <h3 class='c-luckybag-item__title'>{title}</h3>
    <div class='c-luckybag-item__contents'>
      <div class='c-luckybag-item__contents-column'>
        {
          leftContents.map((content) => (
            <div class='c-luckybag-item__content'>
              <img
                src='/hana.svg'
                alt=''
                class='c-luckybag-item__content-icon'
                aria-hidden='true'
                width='16'
                height='16'
              />
              <span class='c-luckybag-item__content-text'>
                {content.name}×{content.quantity}
              </span>
            </div>
          ))
        }
      </div>
      <div class='c-luckybag-item__contents-column'>
        {
          rightContents.map((content) => (
            <div class='c-luckybag-item__content'>
              <img
                src='/hana.svg'
                alt=''
                class='c-luckybag-item__content-icon'
                aria-hidden='true'
                width='16'
                height='16'
              />
              <span class='c-luckybag-item__content-text'>
                {content.name}×{content.quantity}
              </span>
            </div>
          ))
        }
      </div>
    </div>
    <a href={buttonHref} class='c-luckybag-item__button'>
      詳しくはこちら
      <svg
        class='c-luckybag-item__button-icon'
        aria-hidden='true'
        width='16'
        height='16'
        viewBox='0 0 16 16'
        fill='none'
        xmlns='http://www.w3.org/2000/svg'
      >
        <path
          d='M6 4L10 8L6 12'
          stroke='currentColor'
          stroke-width='2'
          stroke-linecap='round'
          stroke-linejoin='round'></path>
      </svg>
    </a>
  </div>
</article>
