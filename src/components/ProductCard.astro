---
import Image from 'astro/components/Image.astro';
import type { ImageMetadata } from 'astro';

interface Props {
  title: string;
  price: string;
  description: string;
  buttonText?: string;
  buttonHref?: string;
  image?:
    | { src: ImageMetadata; alt: string; width?: number; height?: number }
    | { src: string; alt: string; width?: number; height?: number };
}

const {
  title,
  price,
  description,
  buttonText = '詳しくはこちら',
  buttonHref,
  image,
} = Astro.props;

// 画像オブジェクトか文字列かを判定
const isImageMetadata = (
  img: typeof image
): img is { src: ImageMetadata; alt: string; width?: number; height?: number } => {
  return img !== undefined && typeof img.src === 'object' && img.src !== null && 'src' in img.src;
};
---

<article class='c-product-card'>
  {
    image && (
      <div class='c-product-card__images'>
        {isImageMetadata(image) ? (
          <Image
            src={image.src}
            alt={image.alt}
            class='c-product-card__image'
            width={image.width || image.src.width || 400}
            height={image.height || image.src.height || 300}
            loading='lazy'
          />
        ) : (
          <img
            src={image.src}
            alt={image.alt}
            class='c-product-card__image'
            width={image.width || 400}
            height={image.height || 300}
            loading='lazy'
          />
        )}
      </div>
    )
  }
  <div class='c-product-card__content'>
    <h2 class='c-product-card__title'>{title}</h2>
    <div class='c-product-card__price'>{price}</div>
    <p class='c-product-card__description'>{description}</p>
    <a href={buttonHref} class='c-product-card__button'>
      {buttonText}
      <svg
        class='c-product-card__button-icon'
        aria-hidden='true'
        width='16'
        height='16'
        viewBox='0 0 16 16'
        fill='none'
        xmlns='http://www.w3.org/2000/svg'
      >
        <path
          d='M6 4L10 8L6 12'
          stroke='currentColor'
          stroke-width='2'
          stroke-linecap='round'
          stroke-linejoin='round'></path>
      </svg>
    </a>
  </div>
</article>
